<html>
<head>
	<meta charset="utf-8">
	<title>Silent Eye - GUI</title>
	<link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body style="background-color: #343a40; color: white;">
	<div class="container-fluid">
		<div class="col-md-12" style="text-align: center;">
			<img src="images/icon.png" alt="The Eye" width="64px">
			<h2>SILENT EYE</h2>
		</div>
		<p style="text-align: right;"><span id="devicesCounter">0</span> Devices</p>
		<table class="table table-striped table-dark" id="devicesTable">
			<thead>
				<tr>
					<th scope="col">MAC</th>
					<th scope="col">Vendor</th>
					<th scope="col">RSSI</th>
					<th scope="col">BSSID</th>
					<th scope="col">Time (Unix)</th>
				</tr>
			</thead>
			<tbody>
				
			</tbody>
		</table>
	</div>

	<script type="text/javascript">
		var command = "get_devices";

		var ws = new WebSocket("ws://127.0.0.1:8080/scan");
		ws.onopen = function() {
			ws.send(command);
		};
		ws.onmessage = function (evt) { 
			var received_msg = evt.data;
			AddDevices(received_msg)
		};

		function AddDevices(jsonString) {
			var devices = JSON.parse(jsonString);
			var table = document.getElementById("devicesTable");
			var rows = 1;
			var totalDevices = 0;

			for (var key in devices) {
				var row = table.insertRow(rows);
			    var cellMAC = row.insertCell(0);
			    var cellVendor = row.insertCell(1);
			    var cellRSSI = row.insertCell(2);
			    var cellBSSID = row.insertCell(3);
			    var cellTime = row.insertCell(4);

			    cellMAC.innerHTML = devices[key].MAC;
			    cellVendor.innerHTML = devices[key].Vendor;
			    cellRSSI.innerHTML = devices[key].RSSI;
			    cellBSSID.innerHTML = devices[key].BSSID;

			    // Parse time from Unix
			    var date = new Date(devices[key].DetectedTime*1000)
			    cellTime.innerHTML = date.toString();

			    row++;
			    totalDevices++;
			}

			document.getElementById('devicesCounter').innerHTML = totalDevices;
		}
	</script>
</body>
</html>